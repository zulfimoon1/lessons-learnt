import{c as y,r as N,u as _,a as w,j as e,b as U,d as C,e as F,f as k,g as H,L as q,I,F as L,s as S}from"./index-KPEZ0muq.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T=y("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),D=({teacher:l,onUploadComplete:d})=>{const[p,m]=N.useState(!1),{toast:r}=_(),{t:s}=w(),v=async h=>{var x;const o=(x=h.target.files)==null?void 0:x[0];if(o){if(!o.name.endsWith(".csv")){r({title:s("common.error"),description:s("upload.csvOnly"),variant:"destructive"});return}m(!0);try{const n=(await o.text()).split(`
`).filter(t=>t.trim()),c=n[0].split(",").map(t=>t.trim().toLowerCase());if(!["subject","grade","lesson_topic","class_date","class_time"].every(t=>c.includes(t))){r({title:s("common.error"),description:s("upload.invalidHeaders"),variant:"destructive"});return}const i=[];for(let t=1;t<n.length;t++){const b=n[t].split(",").map(u=>u.trim().replace(/^"|"$/g,""));if(b.length!==c.length)continue;const a={teacher_id:l.id,school:l.school};c.forEach((u,j)=>{a[u]=b[j]}),a.duration_minutes?a.duration_minutes=parseInt(a.duration_minutes)||60:a.duration_minutes=60,i.push(a)}if(i.length===0){r({title:s("common.error"),description:s("upload.noValidData"),variant:"destructive"});return}const{error:g}=await S.from("class_schedules").insert(i);if(g)throw g;r({title:s("upload.success"),description:s("upload.schedulesUploaded",{count:i.length.toString()})}),d(),h.target.value=""}catch(f){console.error("Upload error:",f),r({title:s("common.error"),description:s("upload.failed"),variant:"destructive"})}finally{m(!1)}}};return e.jsxs(U,{children:[e.jsxs(C,{children:[e.jsxs(F,{className:"flex items-center gap-2",children:[e.jsx(T,{className:"w-5 h-5"}),s("upload.bulkSchedule")]}),e.jsxs(k,{children:[s("upload.csvDescription")," "]})]}),e.jsxs(H,{className:"space-y-4",children:[e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg border border-green-200",children:[e.jsx("p",{className:"text-green-800 font-medium mb-2",children:"âœ… Free Feature"}),e.jsx("p",{className:"text-green-700 text-sm",children:"Schedule uploads are available for free to all teachers. Upload your class schedules without needing a subscription."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"csv-upload",children:s("upload.selectFile")}),e.jsx(I,{id:"csv-upload",type:"file",accept:".csv",onChange:v,disabled:p,className:"file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-medium file:bg-green-50 file:text-green-700 hover:file:bg-green-100"})]}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsxs("h4",{className:"font-medium text-blue-800 mb-2 flex items-center gap-2",children:[e.jsx(L,{className:"w-4 h-4"}),s("upload.csvFormat")]}),e.jsxs("p",{className:"text-sm text-blue-700 mb-2",children:[s("upload.requiredColumns"),":"]}),e.jsx("code",{className:"text-xs bg-white p-2 rounded block",children:"subject,grade,lesson_topic,class_date,class_time,duration_minutes,description"}),e.jsx("p",{className:"text-xs text-blue-600 mt-2",children:s("upload.formatNote")})]}),p&&e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-green-600 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-600",children:s("upload.processing")})]})]})]})},M=({teacher:l,onUploadComplete:d})=>e.jsx("div",{className:"space-y-6",children:e.jsx(D,{teacher:l,onUploadComplete:d})});export{M as default};
