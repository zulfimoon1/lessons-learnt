import{c as E,r as n,u as L,a as q,s as m,j as e,b as u,g as x,d as w,e as N,l as _,f as I,k as o,L as y,I as T,S as P,m as M,n as B,o as z,p as g,q as G,i as S,t as H,v as O}from"./index-KPEZ0muq.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R=E("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),$=({teacher:c})=>{const[j,b]=n.useState([]),[C,D]=n.useState(!0),[p,d]=n.useState(!1),[v,h]=n.useState(null),[r,l]=n.useState({title:"",content:"",age_group:""}),{toast:i}=L(),{t}=q();n.useEffect(()=>{c.role==="admin"&&f()},[c]);const f=async()=>{try{const{data:s,error:a}=await m.from("mental_health_articles").select("*").eq("school",c.school).order("created_at",{ascending:!1});if(a)throw a;b(s||[])}catch(s){console.error("Error loading articles:",s),i({title:t("common.error"),description:t("articles.loadFailed"),variant:"destructive"})}finally{D(!1)}},F=async s=>{if(s.preventDefault(),!r.title.trim()||!r.content.trim()||!r.age_group){i({title:t("common.error"),description:t("articles.fillRequired"),variant:"destructive"});return}try{if(v){const{error:a}=await m.from("mental_health_articles").update({...r,updated_at:new Date().toISOString()}).eq("id",v.id);if(a)throw a;i({title:t("articles.updated"),description:t("articles.updatedSuccess")})}else{const{error:a}=await m.from("mental_health_articles").insert({...r,school:c.school,created_by:c.id});if(a)throw a;i({title:t("articles.created"),description:t("articles.createdSuccess")})}l({title:"",content:"",age_group:""}),d(!1),h(null),f()}catch(a){console.error("Error saving article:",a),i({title:t("common.error"),description:t("articles.saveFailed"),variant:"destructive"})}},k=s=>{l({title:s.title,content:s.content,age_group:s.age_group}),h(s),d(!0)},A=async s=>{if(confirm(t("articles.confirmDelete")))try{const{error:a}=await m.from("mental_health_articles").delete().eq("id",s);if(a)throw a;i({title:t("articles.deleted"),description:t("articles.deletedSuccess")}),f()}catch(a){console.error("Error deleting article:",a),i({title:t("common.error"),description:t("articles.deleteFailed"),variant:"destructive"})}};return c.role!=="admin"?null:C?e.jsx(u,{children:e.jsxs(x,{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-green-600 mx-auto mb-2"}),e.jsx("p",{children:t("common.loading")})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs(u,{children:[e.jsx(w,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs(N,{className:"flex items-center gap-2",children:[e.jsx(_,{className:"w-5 h-5"}),t("articles.title")]}),e.jsx(I,{children:t("articles.description")})]}),e.jsxs(o,{onClick:()=>{d(!p),h(null),l({title:"",content:"",age_group:""})},className:"bg-green-600 hover:bg-green-700",children:[e.jsx(R,{className:"w-4 h-4 mr-2"}),t("articles.addNew")]})]})}),p&&e.jsx(x,{children:e.jsxs("form",{onSubmit:F,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(y,{htmlFor:"title",children:t("articles.articleTitle")}),e.jsx(T,{id:"title",value:r.title,onChange:s=>l(a=>({...a,title:s.target.value})),placeholder:t("articles.titlePlaceholder")})]}),e.jsxs("div",{children:[e.jsx(y,{htmlFor:"age_group",children:t("articles.ageGroup")}),e.jsxs(P,{value:r.age_group,onValueChange:s=>l(a=>({...a,age_group:s})),children:[e.jsx(M,{children:e.jsx(B,{placeholder:t("articles.selectAgeGroup")})}),e.jsxs(z,{children:[e.jsx(g,{value:"elementary",children:t("articles.elementary")}),e.jsx(g,{value:"middle",children:t("articles.middle")}),e.jsx(g,{value:"high",children:t("articles.high")}),e.jsx(g,{value:"all",children:t("articles.allAges")})]})]})]}),e.jsxs("div",{children:[e.jsx(y,{htmlFor:"content",children:t("articles.content")}),e.jsx(G,{id:"content",value:r.content,onChange:s=>l(a=>({...a,content:s.target.value})),placeholder:t("articles.contentPlaceholder"),rows:6})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(o,{type:"submit",className:"bg-green-600 hover:bg-green-700",children:t(v?"common.save":"articles.create")}),e.jsx(o,{type:"button",variant:"outline",onClick:()=>{d(!1),h(null),l({title:"",content:"",age_group:""})},children:t("common.cancel")})]})]})})]}),j.length>0&&e.jsx("div",{className:"grid gap-4",children:j.map(s=>e.jsxs(u,{children:[e.jsx(w,{children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx(N,{className:"text-lg",children:s.title}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx(S,{variant:"outline",children:t(`articles.${s.age_group}`)}),e.jsx(S,{variant:"secondary",children:new Date(s.created_at).toLocaleDateString()})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(o,{variant:"outline",size:"sm",onClick:()=>k(s),children:e.jsx(H,{className:"w-4 h-4"})}),e.jsx(o,{variant:"outline",size:"sm",onClick:()=>A(s.id),children:e.jsx(O,{className:"w-4 h-4"})})]})]})}),e.jsx(x,{children:e.jsx("p",{className:"text-gray-700 whitespace-pre-wrap",children:s.content})})]},s.id))}),j.length===0&&!p&&e.jsx(u,{children:e.jsxs(x,{className:"text-center py-8",children:[e.jsx(_,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:t("articles.noArticles")}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:t("articles.getStarted")})]})})]})};export{$ as M};
